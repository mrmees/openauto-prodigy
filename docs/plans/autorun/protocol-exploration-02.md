# Phase 02: Capture and Merge Tooling Scripts

> **Context:** Creating the bash capture script (wraps reconnect.sh with log collection) and the Python log merge script (aligns Pi + phone logs into a unified timeline).
>
> **Reference:** `docs/plans/2026-02-23-protocol-exploration-implementation.md` (Tasks 4-5)
>
> **Prerequisites:** Phase 01 complete (ProtocolLogger exists).

- [x] **Create capture.sh — protocol capture wrapper.** *(Already implemented in 809c94f; fixed executable permission.)* Create `Testing/capture.sh` and `chmod +x`. The script wraps `reconnect.sh` and collects Pi-side protocol log + phone-side logcat. Usage: `./capture.sh [capture_name] [wait_seconds]`. Variables: `ADB="${SCRIPT_DIR}/../platform-tools/adb"`, `PI="matt@192.168.1.149"`, `CAPTURE_DIR="${SCRIPT_DIR}/captures/${CAPTURE_NAME}"`. Flow: (1) create capture dir, (2) clear phone logcat via `$ADB logcat -c`, (3) run `reconnect.sh` with wait param — abort on failure, (4) print "Interact with AA now. Press Enter when done." and `read -r`, (5) `scp ${PI}:/tmp/oap-protocol.log` to capture dir as `pi-protocol.log`, (6) `$ADB logcat -d` to `phone-logcat-raw.log`, then grep filter `CAR\.|GH\.|WIRELESS|PROJECTION|WPP` to `phone-logcat.log`, (7) show summary with `ls -la`. Use a `pi()` helper function: `pi() { ssh -o ConnectTimeout=5 -o BatchMode=yes "$PI" "$@"; }`. Use colored output (RED/GREEN/YELLOW/NC). Commit: `feat: add capture.sh for protocol log collection`

- [ ] **Create merge-logs.py — Pi + phone timeline merger.** Create `Testing/merge-logs.py` and `chmod +x`. Python3 script that merges Pi protocol log (TSV with seconds-since-start timestamps) and phone logcat (HH:MM:SS.mmm timestamps) into a single timeline aligned by TCP connect event. Pi anchor: first line with "Phone→HU" and "VERSION_REQUEST". Phone anchor: first line with "Socket connected". Offset = pi_anchor - phone_anchor. Normalize phone timestamps by adding offset. Output: Markdown with header (entry counts, clock offset), then merged entries in a code block sorted by timestamp, each prefixed with `PI   ` or `PHONE`. Usage: `merge-logs.py <pi-protocol.log> <phone-logcat.log> [output.md]`. Commit: `feat: add log merge script for Pi + phone timeline correlation`
