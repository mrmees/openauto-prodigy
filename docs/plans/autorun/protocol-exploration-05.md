# Phase 05: Probes 4-8 — Palette, Display Features, Voice, 1080p, Sensors

> **Context:** Remaining protocol probes, each testing a single variable against the current baseline. These probes are more exploratory — the exact code changes depend on what proto definitions support.
>
> **Reference:** `docs/plans/2026-02-23-protocol-exploration-implementation.md` (Task 10)
>
> **Prerequisites:** Phase 04 complete (probes 1-3 done, baseline established).
>
> **IMPORTANT:** Each probe requires Pi hardware + interactive capture. Some probes may need proto definition exploration before the code change can be determined.

- [x] **Probe 4: Palette v2 (theme_version).** *(BLOCKED — no theme_version field found in any known proto definitions. Checked aasdk, GAL docs, aa-proxy-rs. Phone expects palette v2 but we report 0. Cosmetic impact only — falls back to default theming. Needs raw protobuf capture from production HU to identify field number. Codex: P1, add raw proto capture + unknown-field diffing workflow.)* Explore the proto definitions in `libs/aasdk/` to find the field for theme version in ServiceDiscoveryResponse. Check `aasdk/proto/ServiceDiscoveryResponseMessage.proto` or similar files. If found, modify `AndroidAutoEntity.cpp` `onServiceDiscoveryRequest()` to set the theme version to 2 in the response. If the field doesn't exist in the proto definitions, document this as a finding. Rsync to Pi, rebuild, capture: `./Testing/capture.sh probe-4-palette-v2`. Diff and check for any changed color/theme behavior on the phone. Create `Testing/captures/probe-4-palette-v2/findings.md`. Commit: `probe: palette v2 theme_version — capture and findings`

- [x] **Probe 5: CarDisplayUiFeatures / hide_clock.** *(hide_clock field 12 is DEAD — no effect on modern AA. Phone still shows clock, hideProjectedClock unchanged. CarDisplayUiFeatures is the modern mechanism. Combined with probe 8 in capture `probe-5-8-hideclock-sensors/`. Codex: P1, shift to CarDisplayUiFeatures implementation.)* Explore proto definitions for display feature fields in ServiceDiscoveryResponse. Look for `hide_clock` (field 12) or `CarDisplayUiFeatures` message. If found, set `hide_clock(true)` in the response. Rsync, rebuild, capture: `./Testing/capture.sh probe-5-display-features`. Check if the phone's status bar clock disappears or if any display layout changes occur. Create `Testing/captures/probe-5-display-features/findings.md`. Commit: `probe: CarDisplayUiFeatures / hide_clock — capture and findings`

- [x] **Probe 6: 1080p video.** *(WORKS — config-only change. Phone renders at 1920x984 (140 DPI), xlrg layout classification. 576 frames/20s. Pi 4 software decode CPU-intensive. Capture in `probe-7-1080p/`. Codex: P0, add adaptive resolution policy + hardware decode path.)* This is config-only — change `videoResolution` in the YAML config (or directly in ServiceFactory where the video config is built) from 720p to 1080p. The AA protocol supports `_1080p` (1920x1080) as a fixed resolution. Rsync, rebuild, capture: `./Testing/capture.sh probe-6-1080p`. Check if the phone renders at 1080p — look for changed AV_SETUP_REQUEST/RESPONSE and different video frame sizes in the protocol log. Create `Testing/captures/probe-6-1080p/findings.md`. Commit: `probe: 1080p video — capture and findings`

- [x] **Probe 7: Extra sensors (compass, accelerometer, gyroscope).** *(PARTIAL SUCCESS — phone requests COMPASS (0x02) and ACCEL (0x13) when advertised, ignores GYRO (0x14). Different reporting mode suffix 0x10 0x03 for IMU sensors. No actual sensor data streamed yet. Combined with probe 5 in capture `probe-5-8-hideclock-sensors/`. Codex: P0/P1, implement real ACCEL/COMPASS streaming with timing conformance.)* Modify `src/core/aa/ServiceFactory.cpp` to add `COMPASS_DATA`, `GYROSCOPE_DATA`, and `ACCELEROMETER_DATA` sensor types to the sensor channel's service discovery config. Check the aasdk proto definitions for the exact enum values. Rsync, rebuild, capture: `./Testing/capture.sh probe-7-extra-sensors`. Check if the phone sends SENSOR_START_REQUEST for any of the new sensors. Create `Testing/captures/probe-7-extra-sensors/findings.md`. Commit: `probe: extra sensors (compass, accel, gyro) — capture and findings`

- [x] **Probe 8: VOICE/ALARM audio channel.** *(SKIPPED — AudioType::ALARM=4 exists but channel IDs 9-13 are unmapped in aasdk. Wrong channel would break session. Needs channel-map discovery from production traces first. Capture in `probe-6-alarm-audio/`. Codex: P2, implement passive channel-ID discovery tooling first.)* Explore aasdk for `AudioType::VOICE` or similar enum. If it exists, add a 4th audio service in ServiceFactory on a new channel. If the enum doesn't exist or the channel mapping is unclear, document what was found and skip the capture. Rsync, rebuild if changed, capture if applicable: `./Testing/capture.sh probe-8-voice-channel`. Create `Testing/captures/probe-8-voice-channel/findings.md` (even if just documenting why it wasn't feasible). Commit: `probe: VOICE audio channel exploration — findings`
